{% if site.google_analytics %}
<!-- Google Analytics (GA4) -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', '{{ site.google_analytics }}', {
        'page_title': '{{ page.title | replace: "'", "\\'" }}',
        'page_path': '{{ site.baseurl }}{{ page.url }}',
        'color_scheme': document.documentElement.classList.contains('dark') ? 'dark' : 'light'
    });

    // Track dark mode usage
    document.addEventListener('DOMContentLoaded', function() {
        const darkModeChanged = () => {
            gtag('event', 'dark_mode_toggle', {
                'dark_mode': document.documentElement.classList.contains('dark')
            });
        };
        // Listen for dark mode changes if you have a toggle button
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', darkModeChanged);
        }
    });
</script>
<!-- End Google Analytics -->
{% endif %}
