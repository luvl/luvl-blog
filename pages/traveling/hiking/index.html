---
layout: page
title: üèîÔ∏è Hiking Adventures
permalink: /traveling/hiking/
---

<style>
  .mountain-list {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
  }

  .dark .mountain-list {
    background: #1f2937;
  }

  .mountains-scroll {
    display: flex;
    gap: 0.75rem;
    overflow-x: auto;
    padding: 0.5rem 0;
    scroll-behavior: smooth;
  }

  .mountains-scroll::-webkit-scrollbar {
    height: 8px;
  }

  .mountains-scroll::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }

  .dark .mountains-scroll::-webkit-scrollbar-track {
    background: #374151;
  }

  .mountains-scroll::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }

  .mountains-scroll::-webkit-scrollbar-thumb:hover {
    background: #555;
  }

  .mountain-item {
    padding: 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    border: 2px solid transparent;
    min-width: 200px;
    flex-shrink: 0;
  }

  .mountain-item:hover {
    background: #f3f4f6;
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .dark .mountain-item:hover {
    background: #374151;
  }

  .mountain-item.active {
    background: #dbeafe;
    border-color: #3b82f6;
    box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
  }

  .dark .mountain-item.active {
    background: #1e3a5f;
    border-color: #3b82f6;
  }

  .mountain-item.peak-completed::before {
    content: 'üü¢';
    margin-right: 8px;
  }

  .mountain-item.ridge-traverse::before {
    content: 'üîµ';
    margin-right: 8px;
  }

  .mountain-item.challenging-route::before {
    content: 'üî¥';
    margin-right: 8px;
  }

  .mountain-name {
    font-weight: 600;
    font-size: 0.9rem;
    color: #1f2937;
    margin-bottom: 0.25rem;
  }

  .dark .mountain-name {
    color: #f3f4f6;
  }

  .mountain-meta {
    font-size: 0.75rem;
    color: #6b7280;
  }

  .dark .mountain-meta {
    color: #9ca3af;
  }

  #hiking-map {
    height: 600px;
    width: 100%;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    position: relative;
    z-index: 1;
  }

  /* Ensure Leaflet map controls stay below navbar */
  .leaflet-top,
  .leaflet-bottom,
  .leaflet-control,
  .leaflet-pane,
  .leaflet-map-pane {
    z-index: 1 !important;
  }

  .leaflet-tile-pane {
    z-index: 1 !important;
  }

  .nav-buttons {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    gap: 1rem;
  }

  .nav-button {
    padding: 0.5rem 1rem;
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s;
    font-weight: 500;
  }

  .nav-button:hover:not(:disabled) {
    background: #2563eb;
    transform: translateX(0);
  }

  .nav-button:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    opacity: 0.5;
  }

  .nav-button:first-child:hover:not(:disabled) {
    transform: translateX(-2px);
  }

  .nav-button:last-child:hover:not(:disabled) {
    transform: translateX(2px);
  }

  /* Lightbox styles */
  .lightbox-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 9999;
    cursor: pointer;
    animation: fadeIn 0.3s ease;
  }

  .lightbox-overlay.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lightbox-image {
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    animation: zoomIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes zoomIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .lightbox-close {
    position: absolute;
    top: 20px;
    right: 30px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 10000;
    transition: transform 0.2s;
  }

  .lightbox-close:hover {
    transform: scale(1.2);
  }
</style>

{% comment %}
  Calculate statistics from hiking data
{% endcomment %}
{% assign total_peaks = 0 %}
{% assign highest_elevation = 0 %}
{% assign total_hikes = 0 %}

{% for mountain_data in site.data.hiking %}
  {% assign mountain = mountain_data[1] %}
  {% unless mountain.name contains "Template" or mountain.name == nil %}
    {% assign total_peaks = total_peaks | plus: 1 %}
    {% if mountain.elevation > highest_elevation %}
      {% assign highest_elevation = mountain.elevation %}
    {% endif %}
    {% if mountain.visits %}
      {% assign total_hikes = total_hikes | plus: mountain.visits.size %}
    {% endif %}
  {% endunless %}
{% endfor %}

<div class="text-center mb-8 sm:mb-12">
  <p class="text-gray-600 dark:text-gray-400 text-sm sm:text-base">Explore the mountains I've climbed across Japan. Click on any marker to see details about each adventure.</p>
</div>

<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform transition-transform hover:scale-105">
    <div class="text-3xl sm:text-4xl font-bold text-blue-600 dark:text-blue-400 mb-2">{{ total_peaks }}</div>
    <div class="text-sm sm:text-base text-gray-600 dark:text-gray-400">Peaks Conquered</div>
  </div>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform transition-transform hover:scale-105">
    <div class="text-3xl sm:text-4xl font-bold text-green-600 dark:text-green-400 mb-2">{{ total_hikes }}</div>
    <div class="text-sm sm:text-base text-gray-600 dark:text-gray-400">Total Hikes</div>
  </div>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform transition-transform hover:scale-105">
    <div class="text-3xl sm:text-4xl font-bold text-purple-600 dark:text-purple-400 mb-2">7.5h</div>
    <div class="text-sm sm:text-base text-gray-600 dark:text-gray-400">Longest Hiking Day</div>
  </div>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center transform transition-transform hover:scale-105">
    <div class="text-3xl sm:text-4xl font-bold text-red-600 dark:text-red-400 mb-2">{{ highest_elevation }}m</div>
    <div class="text-sm sm:text-base text-gray-600 dark:text-gray-400">Highest Peak</div>
  </div>
</div>

<!-- Mountain Navigation -->
<div class="mountain-list">
  <div class="nav-buttons">
    <button id="prev-mountain" class="nav-button">‚Üê Previous</button>
    <h3 class="text-lg font-bold text-gray-900 dark:text-white">My Mountains</h3>
    <button id="next-mountain" class="nav-button">Next ‚Üí</button>
  </div>
  <div class="mountains-scroll" id="mountain-list-items"></div>
</div>

<!-- Map -->
<div id="hiking-map"></div>

<!-- Lightbox Modal -->
<div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
  <span class="lightbox-close">&times;</span>
  <img id="lightbox-img" class="lightbox-image" src="" alt="Enlarged view">
</div>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<script>
let map;
let markers = [];
let currentMountainIndex = 0;

// Lightbox functions
function openLightbox(imageSrc) {
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img');
  lightboxImg.src = imageSrc;
  lightbox.classList.add('active');
  document.body.style.overflow = 'hidden'; // Prevent background scrolling
}

function closeLightbox() {
  const lightbox = document.getElementById('lightbox');
  lightbox.classList.remove('active');_data/hiking/jinba.yml
  document.body.style.overflow = 'auto'; // Restore scrolling
}

// Close lightbox on Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeLightbox();
  }
});

// Weather icons and labels
const weatherInfo = {
  sunny: { icon: '‚òÄÔ∏è', label: 'Sunny' },
  cloudy: { icon: '‚òÅÔ∏è', label: 'Cloudy' },
  rainy: { icon: 'üåßÔ∏è', label: 'Rainy' },
  foggy: { icon: 'üå´Ô∏è', label: 'Foggy' },
  snowy: { icon: '‚ùÑÔ∏è', label: 'Snowy' },
  clear: { icon: 'üå§Ô∏è', label: 'Clear' },
  partly_cloudy: { icon: '‚õÖ', label: 'Partly Cloudy' }
};

// Observation type icons
const observationIcons = {
  flower: 'üå∏',
  fruit: 'üçì',
  wildlife: 'ü¶å',
  scenery: 'üèûÔ∏è',
  other: '‚ú®'
};

// Load trail definitions
const trailData = [
{% assign first_trail = true %}
{% for trail_hash in site.data.hiking_trails %}
  {% assign trail = trail_hash[1] %}
  {% if trail.id %}
    {% if first_trail == false %},{% endif %}
  {
    id: "{{ trail.id }}",
    name: "{{ trail.name | escape }}",
    description: "{{ trail.description | escape }}",
    mountains: [{% for m in trail.mountains_in_order %}"{{ m }}"{% unless forloop.last %},{% endunless %}{% endfor %}],
    segments: [
      {% for seg in trail.segments %}
      {
        from: "{{ seg.from }}",
        to: "{{ seg.to }}",
        distance: {{ seg.distance }},
        duration: "{{ seg.duration_estimate }}"
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ],
    mapDisplay: {
      color: "{{ trail.map_display.color }}",
      weight: {{ trail.map_display.weight }},
      opacity: {{ trail.map_display.opacity }},
      dashArray: "{{ trail.map_display.dashArray }}"
    }
  }
    {% assign first_trail = false %}
  {% endif %}
{% endfor %}
];

// Load hiking data from Jekyll data files
const hikingData = [
{% assign first_item = true %}
{% for mountain_hash in site.data.hiking %}
  {% assign mountain_name = mountain_hash[0] %}
  {% assign mountain = mountain_hash[1] %}
  {% if mountain.name and mountain.latitude and mountain.longitude %}
    {% assign latest_visit = mountain.visits.first %}
    {% if first_item == false %},{% endif %}
  {
    id: "{{ mountain_name }}",
    name: "{{ mountain.name | escape }}",
    position: [{{ mountain.latitude }}, {{ mountain.longitude }}],
    elevation: "{{ mountain.elevation }}{{ mountain.elevation_unit }}",
    type: "{{ mountain.type }}",
    description: "{{ mountain.description | escape }}",
    blogPost: "{{ site.baseurl }}/{{ latest_visit.blog_post }}/",
    date: "{{ latest_visit.date_display }}",
    difficulty: "{{ mountain.difficulty }}",
    notes: "{{ latest_visit.notes | escape }}",
    totalVisits: {{ mountain.visits.size | default: 1 }},
    visits: [
      {% for visit in mountain.visits %}
      {
        date: "{{ visit.date_display }}",
        trail: "{{ visit.trail }}",
        trailId: "{{ visit.trail_id }}",
        duration: "{{ visit.duration }}",
        weather: {% if visit.weather[0] %}[{% for w in visit.weather %}"{{ w }}"{% unless forloop.last %},{% endunless %}{% endfor %}]{% else %}"{{ visit.weather }}"{% endif %},
        notes: "{{ visit.notes | escape }}",
        images: [{% if visit.images %}{% for img in visit.images %}"{{ img }}"{% unless forloop.last %},{% endunless %}{% endfor %}{% endif %}],
        observations: [
          {% if visit.observations %}
          {% for obs in visit.observations %}
          {
            type: "{{ obs.type }}",
            name: "{{ obs.name | escape }}",
            notes: "{{ obs.notes | escape }}",
            images: [{% if obs.images %}{% for img in obs.images %}"{{ img }}"{% unless forloop.last %},{% endunless %}{% endfor %}{% endif %}]
          }{% unless forloop.last %},{% endunless %}
          {% endfor %}
          {% endif %}
        ]
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
    {% assign first_item = false %}
  {% endif %}
{% endfor %}
];

// Calculate map center (average of all coordinates)
let centerLat = 35.6106, centerLng = 139.2193; // Default to Tokyo area
if (hikingData.length > 0) {
  centerLat = 0;
  centerLng = 0;
  hikingData.forEach(mountain => {
    centerLat += mountain.position[0];
    centerLng += mountain.position[1];
  });
  centerLat /= hikingData.length;
  centerLng /= hikingData.length;
}

function initMap() {
  // Initialize the map centered on the average of all peaks
  map = L.map('hiking-map').setView([centerLat, centerLng], 12);

  // Add OpenStreetMap tiles with multiple layer options
  const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  });

  // Add topographic layer for better mountain visualization
  const topoLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data: ¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: ¬© <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
  });

  // Add satellite imagery layer
  const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
  });

  // Add default layer
  osmLayer.addTo(map);

  // Layer control
  const baseMaps = {
    "Standard": osmLayer,
    "Topographic": topoLayer,
    "Satellite": satelliteLayer
  };

  L.control.layers(baseMaps).addTo(map);

  // Custom icons for different mountain types
  const icons = {
    'peak-completed': L.divIcon({
      className: 'custom-marker peak-completed-marker',
      html: '<div style="background: #28a745; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); font-size: 16px;">‚õ∞Ô∏è</div>',
      iconSize: [30, 30],
      iconAnchor: [15, 15]
    }),
    'ridge-traverse': L.divIcon({
      className: 'custom-marker ridge-traverse-marker',
      html: '<div style="background: #007bff; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); font-size: 16px;">üèîÔ∏è</div>',
      iconSize: [30, 30],
      iconAnchor: [15, 15]
    }),
    'challenging-route': L.divIcon({
      className: 'custom-marker challenging-route-marker',
      html: '<div style="background: #dc3545; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); font-size: 16px;">üéØ</div>',
      iconSize: [30, 30],
      iconAnchor: [15, 15]
    })
  };

  // Add markers for each mountain
  hikingData.forEach((mountain, index) => {
    const marker = L.marker(mountain.position, {
      icon: icons[mountain.type]
    }).addTo(map);

    markers.push({ marker, mountain, index });

    // Function to build visit card HTML
    function buildVisitCard(visit, visitNum, totalVisits) {
      let imagesHtml = '';
      if (visit.images && visit.images.length > 0) {
        if (visit.images.length === 1) {
          imagesHtml = `<img src="${visit.images[0]}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 6px; margin: 8px 0; cursor: pointer;" alt="Visit photo" onclick="event.stopPropagation(); openLightbox('${visit.images[0]}')">`;
        } else {
          imagesHtml = '<div style="display: flex; gap: 4px; overflow-x: auto; margin: 8px 0;">';
          visit.images.forEach(img => {
            imagesHtml += `<img src="${img}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 6px; flex-shrink: 0; cursor: pointer;" alt="Visit photo" onclick="event.stopPropagation(); openLightbox('${img}')">`;
          });
          imagesHtml += '</div>';
        }
      }

      // Trail information
      let trailInfoHtml = '';
      if (visit.trailId) {
        const trail = trailData.find(t => t.id === visit.trailId);
        if (trail) {
          trailInfoHtml = `
            <div style="margin-top: 8px; padding: 6px; background: #f0f9ff; border-radius: 4px; border-left: 3px solid ${trail.mapDisplay.color};">
              <div style="font-size: 11px; color: #0369a1; font-weight: 600; margin-bottom: 2px;">üó∫Ô∏è ${trail.name}</div>
              <div style="font-size: 10px; color: #0c4a6e;">${trail.description}</div>
              <div style="font-size: 10px; color: #0c4a6e; margin-top: 2px;">Route: ${trail.mountains.map(m => m.charAt(0).toUpperCase() + m.slice(1)).join(' ‚Üí ')}</div>
            </div>
          `;
        }
      }

      // Special observations
      let observationsHtml = '';
      if (visit.observations && visit.observations.length > 0) {
        observationsHtml = '<div style="margin-top: 8px; padding: 8px; background: #f0fdf4; border-radius: 4px; border-left: 3px solid #22c55e;">';
        observationsHtml += '<div style="font-size: 11px; color: #166534; font-weight: 600; margin-bottom: 4px;">üåø Special Observations</div>';

        visit.observations.forEach(obs => {
          const icon = observationIcons[obs.type] || '‚ú®';
          observationsHtml += `<div style="margin-bottom: 6px;">`;
          observationsHtml += `<div style="font-size: 11px; font-weight: 600; color: #15803d;">${icon} ${obs.name}</div>`;
          if (obs.notes) {
            observationsHtml += `<div style="font-size: 10px; color: #166534; margin: 2px 0;">${obs.notes}</div>`;
          }
        if (obs.images && obs.images.length > 0) {
          observationsHtml += '<div style="display: flex; gap: 5px; margin-top: 5px; overflow-x: auto;">';
          obs.images.forEach(img => {
            observationsHtml += `<img src="${img}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 6px; flex-shrink: 0; cursor: pointer;" alt="${obs.name}" onclick="event.stopPropagation(); openLightbox('${img}')">`;
          });
          observationsHtml += '</div>';
        }
          observationsHtml += '</div>';
        });

        observationsHtml += '</div>';
      }

      // Visit details
      let visitDetails = '';
      if (visit.trail) {
        visitDetails += `<div style="font-size: 11px; color: #64748b; margin: 3px 0;"><strong>Trail:</strong> ${visit.trail}</div>`;
      }
      if (visit.duration) {
        visitDetails += `<div style="font-size: 11px; color: #64748b; margin: 3px 0;"><strong>Duration:</strong> ${visit.duration}</div>`;
      }
      if (visit.weather) {
        const weatherArray = Array.isArray(visit.weather) ? visit.weather : [visit.weather];
        const weatherDisplay = weatherArray
          .filter(w => weatherInfo[w])
          .map(w => `${weatherInfo[w].icon} ${weatherInfo[w].label}`)
          .join(' & ');
        if (weatherDisplay) {
          visitDetails += `<div style="font-size: 11px; color: #64748b; margin: 3px 0;"><strong>Weather:</strong> ${weatherDisplay}</div>`;
        }
      }
      if (visit.notes) {
        visitDetails += `<div style="margin-top: 6px; font-size: 11px; font-style: italic; color: #666;">"${visit.notes}"</div>`;
      }

      const isLatest = visitNum === 1;
      const badgeColor = isLatest ? '#10b981' : '#6b7280';
      const badgeText = isLatest ? 'üìç Latest Visit' : `Visit #${totalVisits - visitNum + 1}`;

      return `
        <div style="border: 1px solid #e5e7eb; border-radius: 6px; padding: 10px; margin-bottom: 10px; background: ${isLatest ? '#f0fdf4' : '#f9fafb'};">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
            <div style="font-size: 13px; font-weight: 600; color: #1f2937;">üìÖ ${visit.date}</div>
            <div style="background: ${badgeColor}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 600;">${badgeText}</div>
          </div>
          ${visitDetails}
          ${imagesHtml}
          ${observationsHtml}
          ${trailInfoHtml}
        </div>
      `;
    }

    // Create popup content with all visits
    const latestVisit = mountain.visits[0];

    // Generate a unique ID for this popup
    const popupId = `popup-${index}`;

    // Build all visits HTML with collapsible section
    let allVisitsHtml = '';
    if (mountain.totalVisits > 1) {
      // Show latest visit
      allVisitsHtml = `
        <div style="margin-top: 10px;">
          <div style="font-size: 14px; font-weight: 600; color: #1f2937; margin-bottom: 8px;">
            üìç Latest Visit (${mountain.totalVisits} total)
          </div>
          ${buildVisitCard(latestVisit, 1, mountain.totalVisits)}
        </div>
      `;

      // Add collapsible section for previous visits
      const previousVisits = mountain.visits.slice(1);
      allVisitsHtml += `
        <div style="margin-top: 10px;">
          <button
            id="toggle-${popupId}"
            onclick="
              const content = document.getElementById('previous-${popupId}');
              const btn = document.getElementById('toggle-${popupId}');
              if (content.style.display === 'none') {
                content.style.display = 'block';
                btn.innerHTML = '‚ñº Hide ${previousVisits.length} previous visit${previousVisits.length > 1 ? 's' : ''}';
              } else {
                content.style.display = 'none';
                btn.innerHTML = '‚ñ∂ Show ${previousVisits.length} previous visit${previousVisits.length > 1 ? 's' : ''}';
              }
            "
            style="width: 100%; padding: 8px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; color: #374151; transition: all 0.2s;"
            onmouseover="this.style.background='#e5e7eb'"
            onmouseout="this.style.background='#f3f4f6'"
          >
            ‚ñ∂ Show ${previousVisits.length} previous visit${previousVisits.length > 1 ? 's' : ''}
          </button>
          <div id="previous-${popupId}" style="display: none; margin-top: 10px; max-height: 300px; overflow-y: auto; padding-right: 5px;">
            ${previousVisits.map((visit, idx) => buildVisitCard(visit, idx + 2, mountain.totalVisits)).join('')}
          </div>
        </div>
      `;
    } else {
      // Single visit - show it in a card
      allVisitsHtml = `
        <div style="margin-top: 10px;">
          ${buildVisitCard(latestVisit, 1, 1)}
        </div>
      `;
    }

    const popupContent = `
      <div style="max-width: 420px; font-family: system-ui, -apple-system, sans-serif;">
        <h3 style="color: #333; margin: 0 0 10px 0; font-size: 18px;">${mountain.name}</h3>
        <p style="margin: 5px 0; font-size: 13px;"><strong>‚õ∞Ô∏è Elevation:</strong> ${mountain.elevation}</p>
        <p style="margin: 5px 0; font-size: 13px;"><strong>üéØ Difficulty:</strong> ${mountain.difficulty}</p>
        <p style="margin: 10px 0; font-size: 13px; color: #666;">${mountain.description}</p>
        ${allVisitsHtml}
        <a href="${mountain.blogPost}" style="color: #007bff; text-decoration: none; font-size: 13px; font-weight: 500; display: inline-block; margin-top: 10px;">
          üìñ Read Full Adventure Story ‚Üí
        </a>
      </div>
    `;

    marker.bindPopup(popupContent, { maxWidth: 420 });
  });

  // Draw trails based on trail definitions
  trailData.forEach(trail => {
    // For each segment in the trail, draw a line between mountains
    trail.segments.forEach(segment => {
      // Find the "from" mountain
      const fromMountain = hikingData.find(m =>
        m.id === segment.from || m.name.toLowerCase().includes(segment.from.toLowerCase())
      );

      // Find the "to" mountain
      const toMountain = hikingData.find(m =>
        m.id === segment.to || m.name.toLowerCase().includes(segment.to.toLowerCase())
      );

      // If both mountains exist, draw the connection
      if (fromMountain && toMountain) {
        const polyline = L.polyline([fromMountain.position, toMountain.position], {
          color: trail.mapDisplay.color,
          weight: trail.mapDisplay.weight,
          opacity: trail.mapDisplay.opacity,
          dashArray: trail.mapDisplay.dashArray
        }).addTo(map);

        // Add tooltip showing trail segment info
        polyline.bindTooltip(
          `<strong>${trail.name}</strong><br>` +
          `${segment.from} ‚Üí ${segment.to}<br>` +
          `Distance: ${segment.distance}km ‚Ä¢ ${segment.duration}`,
          { sticky: true }
        );
      }
    });
  });

  // Add a scale control
  L.control.scale().addTo(map);

  // Build mountain list
  buildMountainList();
  updateNavButtons();
}

function buildMountainList() {
  const listContainer = document.getElementById('mountain-list-items');
  listContainer.innerHTML = '';

  hikingData.forEach((mountain, index) => {
    const item = document.createElement('div');
    item.className = `mountain-item ${mountain.type}`;

    // Add visit badge for mountains with multiple visits
    const visitBadge = mountain.totalVisits > 1
      ? `<div style="display: inline-block; background: #f59e0b; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 600; margin-left: 4px;">üìç ${mountain.totalVisits}x</div>`
      : '';

    item.innerHTML = `
      <div class="mountain-name">${mountain.name}${visitBadge}</div>
      <div class="mountain-meta">
        ${mountain.elevation} ‚Ä¢ ${mountain.difficulty}<br>
        Latest: ${mountain.date}
      </div>
    `;

    item.addEventListener('click', () => {
      selectMountain(index);
    });

    listContainer.appendChild(item);
  });
}

function selectMountain(index) {
  currentMountainIndex = index;
  const { marker, mountain } = markers[index];

  // Pan to mountain and open popup
  map.setView(mountain.position, 14, { animate: true });
  marker.openPopup();

  // Update active state in list
  const scrollContainer = document.getElementById('mountain-list-items');
  document.querySelectorAll('.mountain-item').forEach((item, i) => {
    if (i === index) {
      item.classList.add('active');
      // Scroll the horizontal list to center the active item
      const itemLeft = item.offsetLeft;
      const itemWidth = item.offsetWidth;
      const containerWidth = scrollContainer.offsetWidth;
      scrollContainer.scrollTo({
        left: itemLeft - (containerWidth / 2) + (itemWidth / 2),
        behavior: 'smooth'
      });
    } else {
      item.classList.remove('active');
    }
  });

  updateNavButtons();
}

function updateNavButtons() {
  const prevButton = document.getElementById('prev-mountain');
  const nextButton = document.getElementById('next-mountain');

  prevButton.disabled = currentMountainIndex === 0;
  nextButton.disabled = currentMountainIndex === hikingData.length - 1;
}

// Initialize map when page loads
document.addEventListener('DOMContentLoaded', function() {
  initMap();

  // Navigation buttons
  document.getElementById('prev-mountain').addEventListener('click', () => {
    if (currentMountainIndex > 0) {
      selectMountain(currentMountainIndex - 1);
    }
  });

  document.getElementById('next-mountain').addEventListener('click', () => {
    if (currentMountainIndex < hikingData.length - 1) {
      selectMountain(currentMountainIndex + 1);
    }
  });
});
</script>

<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
